<!--pages/today/index.wxml-->
<view class="mode" style="margin-top: {{tabbarRealHeight  + 'px'}}; height: calc(100vh - {{tabbarRealHeight +90 + 'px'}});">
  <view class="date">
    <view class="date-title">
      <view>今天</view>
      <view></view>
    </view>
    <view class="weekend">
      <view 
        wx:for="{{weekendData}}" wx:key="id" 
        class="{{item.id === weekendActiveIndex ? 'active' : ''}}" 
        bindtap="handleWeekendChange" data-id="{{item.id}}"
      >
        {{item.title}}
      </view>
    </view>
  </view>
  <view class="kcal">
    <view class="top">
      <view class="left">
        <view>热量摄入</view>
        <view>1273</view>
      </view>
      <view class="circle-box">
        <view class="circle">
          <view 
            class="circle-background" 
            style="background: {{circleBackground}};">
          </view>
        </view>
        <view class="circleinfo">
          <view>还能吃</view>
          <view>1273</view>
          <view>建议 2238</view>
        </view>
      </view>
      <view class="right">
        <view>热量消耗</view>
        <view>1672</view>
      </view>
    </view>
    <view class="bottom">
      <view>
        <view>碳水化合物</view>
        <view class="line">
          <view style="width: 10%;"></view>
        </view>
        <view>31 / 313 克</view>
      </view>
      <view>
        <view>蛋白质</view>
        <view class="line">
          <view></view>
        </view>
        <view>0 / 90 克</view>
      </view>
      <view>
        <view>脂肪</view>
        <view class="line">
          <view></view>
        </view>
        <view>0 / 70 克</view>
      </view>
    </view>
  </view>
</view>
<view class="drawer-mask" wx:if="{{showMaskDrawer}}" bindtap="closeCdMaskDrawer"></view>
<view class="drawer {{showMaskDrawer ? 'drawer-show' : ''}}">
  <view class="drawer-header">
    <view class="drawer-title">{{countdownModifyStatus ? '修改倒数日' : '新建倒数日'}}</view>
    <view class="drawer-close" bindtap="closeCdMaskDrawer">×</view>
  </view>
  
  <view class="drawer-content">
    <view class="form-group">
      <view class="account-title">标题<text class="required">*</text></view>
      <view class="account-input">
        <input type="text" value="{{formData.title}}" bindinput="handleTitleInput" placeholder-class="placeholderClass" placeholder="请输入倒数日标题" />
      </view>
      <view class="option-item">
        <text>日期类型</text>
        <switch checked="{{formData.calendar_type === 'gregorian'}}" bindchange="handleCalendarTypeChange" color="#18181B"/>
      </view>
      <block wx:if="{{formData.calendar_type === 'gregorian'}}">
        <view class="account-title">公历日期<text class="required">*</text></view>
        <view class="account-input">
          <picker mode="date" value="{{formData.gregorian_date}}" bindchange="handleGregorianDateChange">
            <view class="{{formData.gregorian_date ? '' : 'placeholderClass'}}">
              {{formData.gregorian_date || '请选择日期'}}
            </view>
          </picker>
        </view>
      </block>

      <block wx:else>
        <view class="account-title">农历日期<text class="required">*</text></view>
        <view class="account-input" bindtap="showLunarPicker">
          <view class="{{formData.lunar_date ? '' : 'placeholderClass'}}">
            {{formData.lunar_date || '请选择日期'}}
          </view>
          
        </view>
      </block>

      <view class="options-group">
        <view class="option-item">
          <text>置顶</text>
          <switch checked="{{formData.is_pinned}}" bindchange="handlePinnedChange" color="#18181B"/>
        </view>

        <view class="option-item">
          <text>提醒</text>
          <switch checked="{{formData.is_reminder}}" bindchange="handleReminderChange" color="#18181B"/>
        </view>

        <block wx:if="{{formData.is_reminder}}">
          <view class="account-title">提醒频率</view>
          <view class="account-input">
            <picker mode="selector" range="{{frequency}}" range-key="title" value="{{formData.reminder_frequency}}" bindchange="handleReminderFrequencyChange">
              <view class="{{formData.reminder_frequency ? '' : 'placeholderClass'}}">
                {{formData.reminder_frequencyTitle || '请选择提醒频率'}}
              </view>
            </picker>
          </view>
        </block>

        <view class="option-item">
          <text>重复</text>
          <switch checked="{{formData.is_repeating}}" bindchange="handleRepeatingChange" color="#18181B"/>
        </view>

        <block wx:if="{{formData.is_repeating}}">
          <view class="account-title">重复频率</view>
          <view class="account-input">
            <picker mode="selector" range="{{frequency}}" range-key="title" value="{{formData.repeat_frequency}}" bindchange="handleRepeatFrequencyChange">
              <view class="{{formData.repeat_frequency ? '' : 'placeholderClass'}}">
                {{formData.repeat_frequencyTitle || '请选择重复频率'}}
              </view>
            </picker>
          </view>
        </block>
      </view>
    </view>

    <view class="btn-group">
      <view class="wx-login-btn" bindtap="submitForm">保存</view>
      <view class="otherlogin" bindtap="handleCdDelete" data-id="{{formData.id}}">删除</view>
    </view>
  </view>
</view>

<lunar-picker show="{{lunarPickerStatus}}" bindconfirm="handleLunarDateChange" value="{{ pickedLunarDate }}">
  <view>{{ pickedLunarDate }}</view>
</lunar-picker>