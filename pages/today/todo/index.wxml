<!--pages/today/index.wxml-->
<view class="mode" style="margin-top: {{tabbarRealHeight  + 'px'}}; height: calc(100vh - {{tabbarRealHeight +90 + 'px'}});">
	<view class="modetitle">
		<view class="top">待办</view>
		<view class="bottom">{{todoData.length > 0 ? '看看今天有啥要做的' : '看来今天并没有什么事儿做'}}</view>
		<view class="opt" bind:tap="addTodo">
			<image src="/static/image/add.png"></image>
		</view>
	</view>
	<view class="todo">
		<movable-area class="todoItem-wrapper" wx:for="{{todoData}}" wx:key="index">
			<movable-view class="todoItem-content" 
				direction="horizontal" 
				x="{{item.x}}"
				damping="20"
				friction="5"
				out-of-bounds="{{true}}"
				inertia="{{false}}"
				bindchange="handleMovableChange" 
				data-index="{{index}}"
			>
				<view class="todoItem {{item.done == 1 ? 'done' : ''}}">
					<view class="todoItemDone">
						<view wx:if="{{item.done == 1}}"></view>
					</view>
					<view class="todoItemContent" bind:tap="closeDrawer" data-index="{{index}}">
						<view>{{item.title}}</view>
						<view wx:if="{{item.description}}">{{item.description}}</view>
					</view>
					<view class="todoItemTime">
						<view class="todoItemAlert" wx:if="{{item.alert == 1}}">
							<image src="{{item.done == 1 ? '/static/image/noticedone.png' : '/static/image/notice.png'}}" ></image>
						</view>
						<view class="todoItemTimeText">{{item.time}}</view>
					</view>
				</view>
				<view class="todoItem-buttons">
					<view class="todoItem-done" bindtap="handleDone" data-id="{{item.id}}" data-done="{{item.done}}">完成</view>
					<view class="todoItem-delete" bindtap="handleDelete" data-id="{{item.id}}">删除</view>
				</view>
			</movable-view>
		</movable-area>
	</view>
	<view class="modetitle">
		<view class="top">备忘</view>
		<view class="bottom">{{todoData.length > 0 ? '看看之前记了哪些' : '记得随时记录'}}</view>
		<view class="opt" bind:tap="addMemos">
			<image src="/static/image/add.png"></image>
		</view>
	</view>
	<view class="todo">
		<movable-area class="todoItem-wrapper" wx:for="{{memosData}}" wx:key="index">
			<movable-view class="todoItem-content" 
				direction="horizontal" 
				x="{{item.x}}"
				damping="20"
				friction="5"
				out-of-bounds="{{true}}"
				inertia="{{false}}"
				bindchange="handleMovableChange" 
				data-index="{{index}}"
			>
				<view class="todoItem">
          {{item.title}}
				</view>
				<view class="todoItem-buttons">
					<view class="todoItem-done" bindtap="handleDone" data-id="{{item.id}}" data-done="{{item.done}}">完成</view>
					<view class="todoItem-delete" bindtap="handleDelete" data-id="{{item.id}}">删除</view>
				</view>
			</movable-view>
		</movable-area>
	</view>
</view>
<view class="drawer-mask" wx:if="{{showMaskDrawer}}" bindtap="closeMaskDrawer"></view>
<view class="drawer {{showMaskDrawer ? 'drawer-show' : ''}}">
  <view class="drawer-header">
    <view class="drawer-title">新建待办</view>
    <view class="drawer-close" bindtap="closeMaskDrawer">×</view>
  </view>
  
  <view class="drawer-content">
    <view class="form-group">
      <view class="account-title">标题<text class="required">*</text></view>
      <view class="account-input">
        <input type="text" value="{{formData.title}}" bindinput="handleTitleInput" placeholder-class="placeholderClass" placeholder="请输入待办标题" />
      </view>

      <view class="date-time-group">
        <view class="date-item">
          <view class="account-title">日期<text class="required">*</text></view>
          <view class="account-input">
            <picker mode="date" value="{{formData.date}}" bindchange="dateChange">
              <view class="{{formData.date ? '' : 'placeholderClass'}}">{{formData.date || '请选择日期'}}</view>
            </picker>
          </view>
        </view>

        <view class="time-item">
          <view class="account-title">时间<text class="required">*</text></view>
          <view class="account-input">
            <picker mode="time" value="{{formData.time}}" bindchange="timeChange" fields="minute">
              <view class="{{formData.time ? '' : 'placeholderClass'}}">{{formData.time ? formData.time + ':00' : '请选择时间'}}</view>
            </picker>
          </view>
        </view>

        <view class="alert-item">
          <view class="account-title">提醒<text class="required">*</text></view>
          <view class="alert-switch">
            <switch checked="{{formData.alert === 1}}" bindchange="alertChange" color="#18181B"/>
          </view>
        </view>
      </view>

      <view class="account-title">标签</view>
      <view class="account-input">
        <input type="text" value="{{formData.category}}" bindinput="handleCategoryInput" placeholder-class="placeholderClass" placeholder="请输入标签" />
      </view>

      <view class="account-title">描述</view>
      <view class="account-input textarea-container">
        <textarea value="{{formData.description}}" bindinput="handleDescriptionInput" placeholder-class="placeholderClass" placeholder="请输入待办描述" />
      </view>
    </view>

    <view class="btn-group">
      <view class="wx-login-btn" bindtap="submitForm">保存</view>
      <view class="otherlogin" bindtap="closeMaskDrawer">取消</view>
    </view>
  </view>
</view>